#include<stdio.h>
#include<string.h>
#include<ctype.h>

char prod[10][20];
char follow[10][20];
int n;

int isNonTerminal(char c)
{
    return (c >= 'A' && c <= 'Z');
}

void addFollow(int i, char c)
{
    int k;
    for(k = 0; follow[i][k] != '\0'; k++)
        if(follow[i][k] == c)
            return;

    follow[i][k] = c;
    follow[i][k+1] = '\0';
}

/* Get index of non-terminal */
int getIndex(char c)
{
    for(int i = 0; i < n; i++)
        if(prod[i][0] == c)
            return i;
    return -1;
}

void findFollow(int i)
{
    if(i == 0)      // Start symbol
        addFollow(i, '$');

    for(int j = 0; j < n; j++)
    {
        char *rhs = strchr(prod[j], '>') + 1;

        for(int k = 0; rhs[k] != '\0'; k++)
        {
            if(rhs[k] == prod[i][0])
            {
                if(rhs[k+1] != '\0')     // symbol followed by something
                {
                    char next = rhs[k+1];

                    if(!isNonTerminal(next))
                    {
                        addFollow(i, next);
                    }
                }
                else    // symbol at end â†’ add FOLLOW of LHS
                {
                    if(prod[j][0] != prod[i][0])
                    {
                        int idx = getIndex(prod[j][0]);
                        findFollow(idx);
                        strcat(follow[i], follow[idx]);
                    }
                }
            }
        }
    }
}

int main()
{
    int i;

    printf("Enter number of productions: ");
    scanf("%d", &n);

    printf("Enter productions (use @ for epsilon):\n");
    for(i = 0; i < n; i++)
        scanf("%s", prod[i]);

    for(i = 0; i < n; i++)
        follow[i][0] = '\0';

    for(i = 0; i < n; i++)
        findFollow(i);

    printf("\nFOLLOW sets:\n");
    for(i = 0; i < n; i++)
        printf("FOLLOW(%c) = { %s }\n", prod[i][0], follow[i]);

    return 0;
}
